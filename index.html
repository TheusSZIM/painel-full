<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetControl Pro | Sistema Online</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        :root {
            --primary: #0f172a; --secondary: #1e293b; --accent: #f59e0b;
            --accent-hover: #d97706; --success: #10b981; --danger: #ef4444;
            --info: #3b82f6; --bg: #f8fafc; --surface: #ffffff;
            --text: #334155; --text-light: #94a3b8; --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
        header { background: white; border-bottom: 1px solid var(--border); padding: 1rem 0; position: sticky; top: 0; z-index: 100; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .brand { display: flex; align-items: center; gap: 1rem; }
        .logo { width: 40px; height: 40px; background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
        .connection-status { display: flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; border: 1px solid; }
        .connection-status.online { background: #d1fae5; color: #047857; border-color: #6ee7b7; }
        .connection-status.offline { background: #fee2e2; color: #991b1b; border-color: #fca5a5; }
        .nav-tabs { display: flex; gap: 0.5rem; background: var(--bg); padding: 0.25rem; border-radius: 8px; border: 1px solid var(--border); }
        .nav-tab { padding: 0.5rem 1rem; border: none; background: transparent; color: var(--text-light); font-weight: 600; font-size: 0.875rem; border-radius: 6px; cursor: pointer; }
        .nav-tab.active { background: white; color: var(--primary); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .section { display: none; padding: 2rem 0; }
        .section.active { display: block; }
        .form-container { max-width: 700px; margin: 0 auto; background: white; border-radius: 16px; padding: 2rem; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.875rem; }
        .form-control { width: 100%; padding: 0.75rem; border: 1.5px solid var(--border); border-radius: 8px; }
        .radio-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem; }
        .radio-card input { position: absolute; opacity: 0; }
        .radio-content { padding: 0.875rem; border: 1.5px solid var(--border); border-radius: 8px; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; background: white; }
        .radio-card input:checked + .radio-content { border-color: var(--accent); background: #fffbeb; }
        .btn-submit { width: 100%; padding: 1rem; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); border-top: 4px solid var(--border); }
        .stat-card.red { border-top-color: var(--danger); }
        .stat-card.blue { border-top-color: var(--info); }
        .stat-card.yellow { border-top-color: var(--warning); }
        .stat-card.green { border-top-color: var(--success); }
        .requests-list { display: flex; flex-direction: column; gap: 0.75rem; }
        .request-card { background: white; border-radius: 10px; border: 1px solid var(--border); padding: 1rem; display: flex; align-items: center; gap: 1rem; border-left: 5px solid #ccc; }
        .request-card.urgente { border-left-color: var(--danger); }
        .request-card.andamento { border-left-color: var(--warning); }
        .request-card.concluido { border-left-color: var(--success); }
        .btn-action { padding: 0.5rem 1rem; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; }
        .btn-start { background: var(--primary); color: white; }
        .btn-finish { background: var(--success); color: white; }
        .toast { position: fixed; bottom: 2rem; right: 2rem; padding: 1rem; border-radius: 8px; color: white; display: none; z-index: 1000; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<header>
    <div class="container">
        <div class="header-content">
            <div class="brand"><div class="logo">‚ö°</div><h1>FleetControl Pro</h1></div>
            <div style="display: flex; gap: 1rem;">
                <div id="connStatus" class="connection-status offline"><span>‚óè</span> OFFLINE</div>
                <nav class="nav-tabs">
                    <button class="nav-tab active" onclick="showTab('form')">üìù Solicitar</button>
                    <button class="nav-tab" onclick="showTab('dashboard')">üìä Painel</button>
                </nav>
            </div>
        </div>
    </div>
</header>

<section id="formSection" class="section active">
    <div class="container">
        <div class="form-container">
            <form id="requestForm" onsubmit="handleSubmit(event)">
                <div class="form-group"><label class="form-label">Solicitante</label><input type="text" class="form-control" id="solicitante" required></div>
                <div class="form-group"><label class="form-label">√Årea</label>
                    <div class="radio-group">
                        <label class="radio-card"><input type="radio" name="area" value="Inje√ß√£o Alum√≠nio" required><div class="radio-content">Inje√ß√£o Alum√≠nio</div></label>
                        <label class="radio-card"><input type="radio" name="area" value="Log√≠stica"><div class="radio-content">Log√≠stica</div></label>
                        <label class="radio-card"><input type="radio" name="area" value="Montagem"><div class="radio-content">Montagem</div></label>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">Opera√ß√£o</label>
                    <div class="radio-group">
                        <label class="radio-card"><input type="radio" name="tipo" value="Entrega" required><div class="radio-content">Entrega</div></label>
                        <label class="radio-card"><input type="radio" name="tipo" value="Guarda"><div class="radio-content">Guarda</div></label>
                    </div>
                </div>
                <div class="form-group"><label class="form-label">C√≥digo do Item</label><input type="text" class="form-control" id="codigo" required></div>
                <div class="form-group"><label class="form-label">Tempo/Prioridade</label>
                    <div class="radio-group">
                        <label class="radio-card"><input type="radio" name="tempo" value="00:15 (Urgente)" required><div class="radio-content">00:15 Urgente</div></label>
                        <label class="radio-card"><input type="radio" name="tempo" value="01:00 (Normal)"><div class="radio-content">01:00 Normal</div></label>
                    </div>
                </div>
                <button type="submit" class="btn-submit" id="submitBtn">Enviar Solicita√ß√£o</button>
            </form>
        </div>
    </div>
</section>

<section id="dashboardSection" class="section">
    <div class="container">
        <div class="stats-grid">
            <div class="stat-card red"><div>Urgentes</div><div id="statUrgent" style="font-size:1.5rem; font-weight:bold;">0</div></div>
            <div class="stat-card blue"><div>Pendentes</div><div id="statPending" style="font-size:1.5rem; font-weight:bold;">0</div></div>
            <div class="stat-card yellow"><div>Em Andamento</div><div id="statProgress" style="font-size:1.5rem; font-weight:bold;">0</div></div>
            <div class="stat-card green"><div>Conclu√≠das</div><div id="statDone" style="font-size:1.5rem; font-weight:bold;">0</div></div>
        </div>
        <div id="requestsList" class="requests-list"></div>
    </div>
</section>

<div id="toast" class="toast"></div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbwGYR1zCBGCK4LeXy_F-7zEYNYhGcKgZ4UUtDVAtfgamYySW2-cVBe9afMJyZ5r5cyXEA/exec'; // Substitua pela sua URL final
    let requests = [];

    async function loadData() {
        if (!API_URL.startsWith('http')) return;
        try {
            const response = await fetch(`${API_URL}?t=${Date.now()}`);
            const data = await response.json();
            if (Array.isArray(data)) {
                requests = data;
                updateConnectionStatus(true);
                renderRequests();
                updateStats();
            }
        } catch (e) {
            updateConnectionStatus(false);
            console.error("Erro de conex√£o:", e);
        }
    }

    function renderRequests() {
        const container = document.getElementById('requestsList');
        if (requests.length === 0) {
            container.innerHTML = "<div style='text-align:center; padding:2rem;'>Nenhuma solicita√ß√£o encontrada.</div>";
            return;
        }
        container.innerHTML = requests.map(req => {
            const isUrgent = req.tempo && req.tempo.includes('Urgente');
            const cardClass = isUrgent ? 'urgente' : (req.status || '');
            return `
                <div class="request-card ${cardClass}">
                    <div style="flex:1">
                        <strong>${req.tipo || 'Op'}: ${req.codigo || 'S/C'}</strong><br>
                        <small>üë§ ${req.solicitante} | üè≠ ${req.area} | üïê ${req.datahora || ''}</small>
                    </div>
                    <div>
                        ${req.status === 'pendente' ? `<button onclick="updateStatus('${req.id}', 'andamento')" class="btn-action btn-start">Iniciar</button>` : ''}
                        ${req.status === 'andamento' ? `<button onclick="updateStatus('${req.id}', 'concluido')" class="btn-action btn-finish">Finalizar</button>` : ''}
                        ${req.status === 'concluido' ? `<span style="color:green; font-weight:bold;">‚úì Conclu√≠do</span>` : ''}
                    </div>
                </div>
            `;
        }).join('');
    }

    async function handleSubmit(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        const formData = {
            solicitante: document.getElementById('solicitante').value,
            area: document.querySelector('input[name="area"]:checked').value,
            tipo: document.querySelector('input[name="tipo"]:checked').value,
            codigo: document.getElementById('codigo').value,
            tempo: document.querySelector('input[name="tempo"]:checked').value,
            observacao: '', localizacao: ''
        };
        try {
            await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(formData) });
            showToast("Sucesso!", "#10b981");
            document.getElementById('requestForm').reset();
            setTimeout(() => { showTab('dashboard'); loadData(); }, 1000);
        } catch (e) { showToast("Erro ao enviar", "#ef4444"); }
        finally { btn.disabled = false; }
    }

    async function updateStatus(id, status) {
        try {
            await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'update', id, status }) });
            showToast("Status atualizado!", "#3b82f6");
            setTimeout(loadData, 1000);
        } catch (e) { showToast("Erro ao atualizar", "#ef4444"); }
    }

    function updateStats() {
        document.getElementById('statUrgent').textContent = requests.filter(r => r.tempo?.includes('Urgente') && r.status !== 'concluido').length;
        document.getElementById('statPending').textContent = requests.filter(r => r.status === 'pendente').length;
        document.getElementById('statProgress').textContent = requests.filter(r => r.status === 'andamento').length;
        document.getElementById('statDone').textContent = requests.filter(r => r.status === 'concluido').length;
    }

    function updateConnectionStatus(online) {
        const el = document.getElementById('connStatus');
        el.className = `connection-status ${online ? 'online' : 'offline'}`;
        el.innerHTML = `<span>‚óè</span> ${online ? 'ONLINE' : 'OFFLINE'}`;
    }

    function showTab(tab) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`${tab}Section`).classList.add('active');
        event.currentTarget?.classList.add('active');
        if (tab === 'dashboard') loadData();
    }

    function showToast(m, c) {
        const t = document.getElementById('toast');
        t.textContent = m; t.style.background = c; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }

    window.onload = loadData;
</script>
</body>
</html>
